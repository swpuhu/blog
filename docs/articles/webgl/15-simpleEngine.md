# 一种简单的渲染引擎实现

## 前言

我们已经学习了很多关于渲染的基础知识了，再继续学习更多有关渲染的知识之前。我想将我们的程序结构稍微的整理一下，一方面是对整个渲染逻辑有个大致的了解，另一方面是为了我们能够更好的扩展我们的程序。因为目前的程序都还是比较简单的，但是我们的代码量却并不少，后续的程序会变得越来越复杂。如果我们不及时的整理我们的代码，我们的代码将会渐渐地变得难以维护。在工作中亦是如此。

所以，本文会介绍一种简单的渲染引擎的实现思路，后续的代码我们也将基于我们自己打造的这个渲染引擎来完成。

### 杂谈

我第一在计算机中接触引擎这个词还是在游戏引擎中，当然，渲染是属于游戏引擎的一部分。游戏引擎使用引擎一次我觉得是十分的恰当的，在汽车中的引擎是一个一直重复做功的机器，而游戏引擎也是类似的，它每一帧都按照相同的运行规则一直做功，但是不同的输入会造成输出的变化。它就像是一个游戏的心脏一般，为游戏的各个模块提供了源源不断的动力。

## 基本架构

现在我们就来看一下一个简单的渲染引擎是如何实现的吧。

上面我提到了引擎是一个循环做功的机器，那么我们的渲染引擎也需要每一帧都执行，在 web 中，我们通常使用`requestAnimationFrame` 这个浏览器提供的 API 来实现这样的需求。每一帧执行的方法我们称之为 `mainLoop`

<ImgContainer :srcs="['/img/15-simpleEngine/engine.png']" :height="300" :forceFlex="true"/>

上面提到了渲染器是属于游戏引擎的子部分，我们为了后续的引擎扩展方便，所以我们也将渲染器设为我们引擎实现的子部分。渲染器表示为 `Renderer`。

在渲染器实现中，参考了现在主流的渲染器实现方案，例如 `THREE`。我们借用了其核心概念。如：

-   场景
-   相机
-   节点
-   网格(Mesh)
-   几何体(Geometry)
-   材质(Material)
-   ……

我们现在就来一个个的介绍一下它们分别都是表示什么意思：

1. 场景：
   场景包含了需要被渲染的所有物体。
2. 相机
   在场景中，可以有 1 个相机或者多个相机。目前我们就认为场景中就只有一个相机就好了，这个相机能看见场景中的所有物体。
3. 节点
   节点用于构造层级树（也就是我们之前提过的[场景图](./9-hierarchy)）
4. 网格(Mesh)
   这是真正被渲染到屏幕上的组件。它决定了物体如何被绘制。它包含了几何体(Geometry)与材质(Material)
5. 几何体
   几何体决定物体的几何形状，包含了物体的顶点数据。
6. 材质
   材质决定了物体是如何渲染的
   <WebGLSimpleEngine/>
